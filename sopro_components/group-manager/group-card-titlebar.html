<link rel="import"
  href="../../bower_components/core-icons/core-icons.html">
<link rel="import"
  href="../sopro-icon-button/sopro-icon-button.html">
<link rel="import"
  href="./titlebar-input.html">

<polymer-element 
name="group-card-titlebar" 
attributes="title editing"
>
  <template>
    <style>
      :host{
        display: block;
        position: relative;
        width: 600px; 
        margin: auto;
        box-sizing: border-box;
        padding: 8px;
      }
      @media screen and (max-width: 600px){
        :host{
          display: block;
          position: relative;
          width: 100%;
        }
      }
      #shadowContainer{
      }
      #titleContainer{
        box-sizing: border-box;
        position: relative;
        background-color: #FFFFFF;
        min-height: 42px; /* Otherwise the sopro-icon-button pushes the height down */
      }
      #titleInput{
        padding-left: 8px;
      }

    </style>

    <div id = "titleContainer" layout horizontal>
      <paper-shadow id="titleShadow" z="{{z}}" animated="true"></paper-shadow>
      <titlebar-input 
      id="titleInput"
      block flex
      label="Add Peer List...."
      value="{{title}}"
      on-input="{{titleInputChanged}}"
      tabindex="-1"
      >
      </titlebar-input>
      <sopro-icon-button 
        id="titleButton"
        icon="arrow-forward" 
        on-click="{{fireCreate}}"
        hidden?="{{!editing || !title}}"
        tabindex="{{(editing && title) ? 0 : -1}}"
        style="{{!title ? 'color: red' : '' }}"
      ></sopro-icon-button>
    </div>
  </template>

  <script>
    Polymer('group-card-titlebar', {
      publish: { // If you want to expose properties as tag attributes
        title: {value:null, reflect:true},
        editing: false,
        z: {value:"0", reflect:true},
      },
      titleInputChanged: function(e){
        // The stock on-change only triggers when you commit the input with
        // enter or a blur. We want to update the title attribute every time the
        // input value changes:
        var t = e.srcElement || e.originalTarget;
        this.title = t.value;
        //console.log(e);
      },
      attached: function(){
        // Save a reference to the group-card-titlebar for use in callbacks:
        var that = this;

        // Handle various keypresses that occur while the group-card-titlebar is focused:
        this.$.titleInput.addEventListener('keypress', function(e){
          if(that.title === null || that.title === ""){
            return;
          };
          if(e.which === 13){ // Enter
            that.fireCreate(); // Call the function that sends a 'create card' event
          };
          if(e.which === 27){ // ESC
            that.stopEditing(); 
          };
          // Any other keys, do nothing (they will probably go to the input)
        });

        // Start editing on focus
        this.$.titleInput.addEventListener('focus', function(e){
          that.editing = true;
          that.z = 1;
        });

        // Stop editing on blur, but only if the input is blank.
        this.$.titleInput.addEventListener('blur', function(e){
          if(that.title === null || that.title === ""){
            that.editing = false;
            that.z = 0;
          }
        });
      },
      fireCreate: function(){
        // Fire an event that tells the group-card index.html to instantiate a
        // new group-card element. Pass it the title.
        this.$.titleInput.blur();
        this.fire('group-card-create', {title: this.title});
        this.title = "";
        this.editing = false;
        this.z = 0;
      },
    });
  </script>
</polymer-element>
