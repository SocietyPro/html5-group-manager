<!-- Import any child components you need -->
<link rel="import"
  href="../../bower_components/core-icons/core-icons.html">
<link rel="import"
  href="../sopro-icon-button/sopro-icon-button.html">
<link rel="import"
  href="./titlebar-input.html">


<!-- 
Declare a <polymer-element name="tag-name" attributes="space separated attributes">
tag-name MUST have at least one dash.
attributes data bind the HTML tag attributes to the DOM properties of the element.

If you two way data binding, (where changing the property also changes the attribute), 
use 'reflect'.
See http://www.polymer-project.org/docs/start/creatingelements.html
and http://www.polymer-project.org/docs/polymer/polymer.html
-->

<polymer-element 
name="group-card-titlebar" 
attributes="title editing"
>
  <!-- 
  Declare a <template><div#ShadowDomDivs></div></template> tree
  You can use {{dataBinding}} syntax in attributes and text nodes, maybe elsewhere?
  -->
  <template>
    <style>
      /* Style this element itself to fill its position: relative container: */
      :host{
        display: block;
        position: relative;
        width: 600px; 
        margin: auto;
        box-sizing: border-box;
        padding: 8px;
      }
      @media screen and (max-width: 600px){
        :host{
          display: block;
          position: relative;
          width: 100%;
        }
      }
      #shadowContainer{
      }
      #titleContainer{
        box-sizing: border-box;
        position: relative;
        background-color: #FFFFFF;
        min-height: 42px; /* Otherwise the sopro-icon-button pushes the height down */
      }
      #titleInput{
        padding-left: 8px;
      }

    </style>

    <div id = "titleContainer" layout horizontal>
      <paper-shadow id="titleShadow" z="{{z}}" animated="true"></paper-shadow>
      <titlebar-input 
      id="titleInput"
      block flex
      label="Type a name for a New Group..."
      value="{{title}}"
      on-input="{{titleInputChanged}}"
      tabindex="-1"
      >
      </titlebar-input>
      <sopro-icon-button 
        id="titleButton"
        icon="arrow-forward" 
        on-click="{{fireCreate}}"
        hidden?="{{!editing || !title}}"
        tabindex="{{(editing && title) ? 0 : -1}}"
        style="{{!title ? 'color: red' : '' }}"
      ></sopro-icon-button>
    </div>
  </template>

  <!-- 
  Call Polymer(tagName, options) to register this element and set up the
  functionality you define with data binding and functions.
  See here for reference:
  http://www.polymer-project.org/docs/polymer/polymer.html
  -->
  <script>
    Polymer('group-card-titlebar', {
      publish: { // If you want to expose properties as tag attributes
        title: {value:null, reflect:true},
        editing: false,
        z: {value:"0", reflect:true},
      },
      titleInputChanged: function(e){
        var t = e.srcElement || e.originalTarget;
        this.title = t.value;
        console.log(e);
      },
      attached: function(){
        var that = this;
        this.$.titleInput.addEventListener('keypress', function(e){
          if(that.title === null || that.title === ""){
            return;
          };
          if(e.which === 13){ // Enter
            that.fireCreate();
          };
          if(e.which === 27){ // ESC
            that.stopEditing();
          };
        });
        this.$.titleInput.addEventListener('focus', function(e){
          that.editing = true;
          that.z = 1;
        });
        this.$.titleInput.addEventListener('blur', function(e){
          if(that.title === null || that.title === ""){
            that.editing = false;
            that.z = 0;
          }
        });
      },
      domReady: function(){
        var titleShadow = this.$.titleShadow;
        titleShadow.target = this.$.titleContainer;
      },
      fireCreate: function(){
        this.$.titleInput.blur();
        this.fire('group-card-create', {title: this.title});
        this.title = "";
        this.editing = false;
        this.z = 0;
      },
    });
  </script>
</polymer-element>
