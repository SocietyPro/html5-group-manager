<!-- Import any child components you need -->
<link rel="import"
  href="../../bower_components/core-icons/core-icons.html">
<link rel="import"
  href="../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import"
  href="./titlebar-input.html">


<!-- 
Declare a <polymer-element name="tag-name" attributes="space separated attributes">
tag-name MUST have at least one dash.
attributes data bind the HTML tag attributes to the DOM properties of the element.

If you two way data binding, (where changing the property also changes the attribute), 
use 'reflect'.
See http://www.polymer-project.org/docs/start/creatingelements.html
and http://www.polymer-project.org/docs/polymer/polymer.html
-->

<polymer-element 
name="group-card-titlebar" 
attributes="editing title"
>
  <!-- 
  Declare a <template><div#ShadowDomDivs></div></template> tree
  You can use {{dataBinding}} syntax in attributes and text nodes, maybe elsewhere?
  -->
  <template>
    <style>
      /* Style this element itself to fill its position: relative container: */
      :host{
        display: block;
        position: relative;
        width: 600px; 
        margin: auto;
      }
      @media screen and (max-width: 600px){
        :host{
          display: block;
          position: relative;
          width: 100%;
        }
      }
      #titleContainer{
        background-color: #FFFFFF;
        margin: 8px;
        min-height: 42px; /* Otherwise the core-icon-button pushes the height down */
      }
      #titleInput{
        margin-left: 8px;
      }

      /* Style a child element declared in the template */
      #wikiTitle{text-align: center}
    </style>

    <div id = "titleContainer" layout horizontal>
      <titlebar-input 
      id="titleInput"
      block flex
      label="Type a name for a New Group..."
      value="{{title}}"
      tabindex="1"
      > </titlebar-input>
      <core-icon-button 
        id="titleButton"
        icon="arrow-forward" 
        on-click="{{fireCreate}}"
        hidden?="{{!editing && !title}}"
        tabindex="2"
      ></core-icon-button>
    </div>

  </template>

  <!-- 
  Call Polymer(tagName, options) to register this element and set up the
  functionality you define with data binding and functions.
  See here for reference:
  http://www.polymer-project.org/docs/polymer/polymer.html
  -->
  <script>
    Polymer('group-card-titlebar', {
      publish: { // If you want to expose properties as tag attributes
        title: null,
        editing: false,
      },
      attached: function(){
        var that = this;
        this.$.titleInput.addEventListener('keydown', function(e){
          if(that.title === null || that.title === ""){
            return;
          };
          if(e.which === 13){
            that.fireCreate();
          };
        });
        this.$.titleButton.addEventListener('keydown', function(e){
          if(that.title === null || that.title === ""){
            return;
          };
          if(e.which === 13 || e.which === 32){
            that.fireCreate();
          };
        });
        this.$.titleInput.addEventListener('focus', function(e){
          that.editing = true;
        });
        this.$.titleInput.addEventListener('blur', function(e){
          that.editing = false;
        });
      },
      fireCreate: function(){
        this.fire('group-card-create', {title: this.title});
        this.title = "";
        this.editing = false;
      },
    });
  </script>
</polymer-element>
