<!DOCTYPE html>
<html ng-app="app" tabindex="-1">
  <head>  
    <script src="bower_components/platform/platform.js"></script>
    <script src="js/angular.js" type="text/javascript"></script>
    <script src="js/angular-route.js" type="text/javascript"></script>
    <script src="js/app.js" type="text/javascript"></script>
    
    <link rel="import" href="bower_components/polymer/polymer.html">
    <link rel="import" href="bower_components/font-roboto/roboto.html">
    <link rel="import" href="bower_components/core-header-panel/core-header-panel.html">
    <link rel="import" href="bower_components/core-menu/core-menu.html">
    <link rel="import" href="bower_components/core-item/core-item.html">
    <link rel="import" href="bower_components/paper-fab/paper-fab.html" >
    <link rel="import" href="sopro_components/core-scaffold/core-scaffold.html">
    <link rel="import" href="sopro_components/group-manager/group-card-titlebar.html">
    <link rel="import" href="sopro_components/group-manager/group-card.html">
    <link rel="import" href="sopro_components/sopro-icon-button/sopro-icon-button.html">

    <link rel="stylesheet" type="text/css" href="css/custom.css">
  </head>
  <body unresolved ng-controller="appCtrl" tabindex="-1">
    <div id="applicationContainer">
      <core-scaffold id="groupScaffold" narrow="true">
        <core-header-panel navigation flex mode="seamed">
          <core-toolbar hidden></core-toolbar>
          <core-menu theme="core-light-theme">
            <core-item icon="settings" label="item1"></core-item>
            <core-item icon="settings" label="item2"></core-item>
          </core-menu>
        </core-header-panel>
        <div class="mainTitle" tool>
            SocietyPro Groups and Governance
        </div>
        <div id="listMorphButtons" tool horizontal layout>
          <sopro-icon-button 
          id="listButton" 
          tabindex="0"
          icon="view-stream"></sopro-icon-button>
          <sopro-icon-button 
          id="gridButton" 
          tabindex="0"
          icon="view-quilt"></sopro-icon-button>
        </div>
        <div layout vertical center id="cards" tabindex="-1">
          <group-card-titlebar> </group-card-titlebar>
          <group-card title="Foobar">
          </group-card>
        </div>
        <paper-fab 
          id="addGroupCardButton" 
          icon="add"
          title="Add New Group"
          role="button"
          tabindex="0"
        ></paper-fab>
      </core-scaffold>
    </div>
  </body>
  <script>
    document.addEventListener('polymer-ready', function () {
      document.getElementById('groupScaffold').closeDrawer();

      // Set up fab to fire group-card-create event when clicked:
      var fab = document.getElementById('addGroupCardButton');
      fab.onclick = function(){
        var fireEvent = 
          new CustomEvent('group-card-create', {
            bubbles: true,
            detail:{ "title": "" } 
          });
        this.dispatchEvent(fireEvent);
      };
      
      fab.onkeypress = function(e){
        if(e.which == 13 || e.which == 32){
          fab.click();
        };
      };

    });
      
    //Actually instantiate a group-card on group-card-create: 
    document.addEventListener('group-card-create', function (event) {
      var newCardEl;
      console.log("core-scaffold heard event group-card-create from some other element");
      //console.log(event);
      var newCard = document.createElement("group-card");
      newCard.title = event.detail.title;
      newCardEl = document.getElementById('cards').appendChild(newCard);

      // Clicking the element immediately seems to fail in firefox, this delay
      // helps?
      window.setTimeout(function(){
        newCardEl.click();
      }, 200)
    });

    /*
    Useful to see what is going on while debugging changing focus with the tab
    key:
    window.setInterval(function(){
      console.log(document.activeElement);
    }, 5000);
    */
  </script>
</html>
